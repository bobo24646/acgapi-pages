#
# https://github.com/P3TERX/IBM-CF-V2
#
# Copyright (c) 2020 P3TERX <https://p3terx.com>
#
# This is free software, licensed under the MIT License.
# See /LICENSE for more information.
#

name: IBM Cloud Foundry - V2Ray

env:
  IBM_CF_API: https://api.us-south.cf.cloud.ibm.com
  IBM_CF_APP_MEM: 128M

on:
  workflow_dispatch:
  repository_dispatch:
  push:
#  schedule:
#    - cron: 0 21 * * 5

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    env:
      IBM_CF_USERNAME: ${{ secrets.IBM_CF_USERNAME }}
      IBM_CF_PASSWORD: ${{ secrets.IBM_CF_PASSWORD }}
      IBM_CF_ORG_NAME: ${{ secrets.IBM_CF_ORG_NAME }}
      IBM_CF_SPACE_NAME: ${{ secrets.IBM_CF_SPACE_NAME }}

    steps:

    - name: Install Cloud Foundry CLI
      run: |
        curl -fsSL https://clis.cloud.ibm.com/install/linux | sh
    - name: Login to IBM Cloud Foundry
      run: ibmcloud login -a https://cloud.ibm.com -u passcode -p ZQHmtkZINu && ibmcloud target --cf

    - name: Deploy Cloud Foundry App
      run: ibmcloud cf push
